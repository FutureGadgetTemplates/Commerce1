---
layout: page
title: Order Confirmed
permalink: /checkout/success/
---
<div class="checkout-success">
  <div class="success-icon">
    <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#28a745" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"></circle>
      <path d="M9 12l2 2 4-4"></path>
    </svg>
  </div>

  <h2>Thank you for your order!</h2>
  <p>Your payment was successful and your order is being processed.</p>
  <p>You will receive an email confirmation shortly.</p>

  <p id="order-saved-msg" style="display: none; color: #28a745;">Order saved to your account!</p>

  <a href="{{ '/' | relative_url }}" class="btn btn-primary">Continue Shopping</a>
  <a href="{{ '/account/' | relative_url }}" class="btn btn-secondary" id="view-orders-btn" style="display: none; margin-left: 10px;">View Orders</a>
</div>

<script>
// Save order to Firestore if user is authenticated
function saveOrderOnSuccess() {
  if (typeof FirebaseAuth === 'undefined') {
    setTimeout(saveOrderOnSuccess, 100);
    return;
  }

  // Check if user is signed in
  if (FirebaseAuth.currentUser) {
    // Get cart data from localStorage before it was cleared
    // We'll use URL params if available, otherwise create a basic order
    const urlParams = new URLSearchParams(window.location.search);
    const sessionId = urlParams.get('session_id');

    const orderData = {
      stripeSessionId: sessionId || 'direct_checkout',
      status: 'completed',
      total: 0, // Will be updated by webhook in production
      items: []
    };

    FirebaseAuth.saveOrder(orderData).then(orderId => {
      if (orderId) {
        document.getElementById('order-saved-msg').style.display = 'block';
        document.getElementById('view-orders-btn').style.display = 'inline-block';
      }
    });
  }
}

document.addEventListener('DOMContentLoaded', function() {
  setTimeout(saveOrderOnSuccess, 500);
});
</script>

<style>
  .btn-secondary {
    background: #6c757d;
    color: white;
  }
  .btn-secondary:hover {
    background: #5a6268;
  }
  .checkout-success {
    text-align: center;
    padding: 60px 20px;
  }
  .success-icon {
    margin-bottom: 30px;
  }
  .checkout-success h2 {
    color: #28a745;
    margin-bottom: 20px;
  }
  .checkout-success p {
    color: #6c757d;
    margin-bottom: 10px;
  }
  .checkout-success .btn {
    margin-top: 30px;
  }
</style>
